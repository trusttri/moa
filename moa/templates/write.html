{% extends "_base_with_nav.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block main %}
  
    <div>
      <h4> Share your experience based on your consent boundaries.</h4>
      Disclosing your experience about relationships with faculty can be anxiety-inducing. Below, you can write what you want to share to an audience you customize based on types of experiences, identities that are important to you, and name(s) of faculty members you want to associate (or avoid).
      Your message will only appear to those who meet the criteria that you set.
    </div>
    <br>
    <div>
      <h5>Write your experience</h5>
      <div>
          <label for="experienceTitle">Title</label>
          <textarea class="form-control" id="experienceTitle" rows="1"></textarea>
      </div>
      <div>
          <label for="experienceText">Experience</label>
          <textarea class="form-control" id="experienceText" rows="3"></textarea>
      </div>
    </div>
    <br>
    <div class="audience-customize experience">
        <h5>Set consent boundary for this experience sharing</h5>
        <!-- Feel free to customize your consent boundary for this individual experience. -->
        <h6>I want to ONLY show this experience to people...</h6>
        <br>
        <div>
          <h6>...who have indicated they have experienced the following.</h6>
          {% for tag in tag_list %}
            <button class="tag advising-experience">{{ tag.keyword }}</button>
          {% endfor %}
          <div>
            <button id="new-experience-tag">add tag</button>
          </div>
        </div>
        <br>
        <div>
          <label for="tag-search">Search keywords:</label>
          <input type="search" id="tag-search" name="q" />
          <button>Search</button>
        </div>
    </div>
    <br>
    <div class="audience-customize identity">
        <h6>...who share the same identities as mine, selected below.</h6>
        {% for identity in identity_list %}
          <button class="tag identity">{{ identity.category}}</button>
        {% endfor %}
    </div>
    <br>
    <div>
      <h6>...who attend the following institutions.</h6>
    </div>
  <!--   <div class="audience-customize">
        <h5>Fa   Â tculty name(s)</h5>
    </div> -->

    <div>
      {% include 'message.html' %}
    </div>

    <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <button class="btn btn-success" type="submit" id="submitExperience">Submit</button>
    </form>


  {% block scripts %}
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script>
      function gatherSelectedTags() {
        tags = []
        $(".tag").each(function() {
          if($(this).hasClass("selected")) {
            tags.push($(this).text());
          }
        })
        return tags
      }

      function submitExperience() {
        var title = $("#experienceTitle").val();
        var description = $("#experienceText").val();
        var tags = gatherSelectedTags();

        $.ajax({
          url: "submit_experience",
          data: {
            'title': title,
            'description': description,
            'tags': JSON.stringify(tags)
          },
          success: function(res){
            console.log("=====success=======")
            console.log(res);
          }
        });
      }

      $('#submitExperience').click(function(event) {
          submitExperience();
          return false;
      });

      $('.tag').click(function(e) {
        if($(this).hasClass("selected")) {
          $(this).removeClass("selected");
        } else {
          $(this).addClass("selected");
        }
      })

      $('#write').click(function(event) {
          console.log("click")
          $(this).addClass("selected");
      });

    </script>
  {% endblock %}

{% endblock %}





